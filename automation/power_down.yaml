- id: power_down_licht_keuken_uit
  alias: "[POWER DOWN] Licht keuken uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.keuken_groep_deconz


- id: power_down_keuken_stroom_uit
  alias: "[POWER DOWN] keuken stroom uit"
  description: >
    Reageert op een 'power_down' event door stroom uit te zetten in de keuken.
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: script.zet_keuken_stroom_uit


- id: power_down_licht_woonkamer_uit
  alias: "[POWER DOWN] Licht woonkamer uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.woonkamer_groep_deconz
    - service: switch.turn_off
      data:
        entity_id: switch.gui_vaaslamp_licht
    # Note: might be unavailable, because it is switched off by hand too.
    - service: light.turn_off
      data:
        entity_id: light.leeslampje_bank


- id: power_down_woonkamer_stroom_uit
  alias: "[POWER DOWN] woonkamer stroom uit"
  description: >
    Reageert op een 'power_down' event door stroom uit te zetten in de woonkamer.
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: script.zet_tvkast_rechts_stroom_uit
    - service: script.zet_tvkast_links_stroom_uit
    - service: script.zet_bank_links_stroom_uit


- id: power_down_licht_voordeur_uit
  alias: "[POWER DOWN] Licht voordeur uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: switch.turn_off
      data:
        entity_id: switch.licht_voordeur_buiten


- id: power_down_licht_tuin_uit
  alias: "[POWER DOWN] Licht tuin uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.buitenstopcontact


- id: power_down_licht_hal_uit
  alias: "[POWER DOWN] Licht hal uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: switch.turn_off
      data:
        entity_id: switch.licht_hal_plafond
    - service: switch.turn_off
      data:
        entity_id: switch.stekker_bij_de_deurbel


- id: power_down_licht_gang_uit
  alias: "[POWER DOWN] Licht gang uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.gang_groep_deconz
    # Stop the cooldown timer, so movement will trigger the light in the
    # hallway to go on. If we triggered a power_down from within the living
    # room, we want the hallway light to work when going to bed for example.
    - wait_template: "{{ is_state('timer.gang_cooldown', 'active') }}"
      timeout: 5      
      continue_on_timeout: 'false'
    - service: timer.cancel
      data:
        entity_id: timer.gang_cooldown


- id: power_down_licht_toilet_uit
  alias: "[POWER DOWN] Licht toilet uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.toilet_groep_deconz
    # Stop the cooldown timer, so movement will trigger the light in the
    # toilet to go on. If we triggered a power_down from within the living
    # room, we want the toilet light to work when going to bed for example
    # (or of course if somebody was in the toilet at this point ;-)
    - wait_template: "{{ is_state('timer.toilet_cooldown', 'active') }}"
      timeout: 5      
      continue_on_timeout: 'false'
    - service: timer.cancel
      data:
        entity_id: timer.toilet_cooldown


- id: power_down_licht_badkamer_uit
  alias: "[POWER DOWN] Licht badkamer uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.badkamer_groep_deconz


- id: power_down_licht_slaapkamer_uit
  alias: "[POWER DOWN] Licht slaapkamer uit"
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: light.turn_off
      data:
        entity_id: light.slaapkamer_groep_deconz


- id: power_down_ps4_uit
  alias: "[POWER DOWN] PS4 uit"
  description: >
    Reageert op een 'power_down' event door de PS4 uit te zetten.
  trigger:
    - platform: event
      event_type: power_down
  action:
    - service: media_player.turn_off
      data:
        entity_id: media_player.ps4


- id: power_down_beepbeep_als_alles_al_uitstond
  alias: "[POWER DOWN] 'beepbeep' als alles al uitstond"
  description: >
    Laat ter bevestiging dat alles uit staat een 'beepbeep' signaal
    horen. Op deze manier kun je als je weggaat horen of de power
    down opdracht (bijv. met de knop bij de voordeur) gelukt is.
  trigger:
    - platform: event
      event_type: power_down
  condition:
    - condition: state
      entity_id: binary_sensor.blackout_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.beepbeep_na_power_down
      state: 'on'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.beepbeep_na_power_down
    - service: shell_command.beepbeep


- id: power_down_beepbeep_als_alles_uitstaat
  alias: "[POWER DOWN] 'beepbeep' als alles uitstaat"
  description: >
    Laat ter bevestiging dat alles uit staat een 'beepbeep' signaal
    horen. Op deze manier kun je als je weggaat horen of de power
    down opdracht (bijv. met de knop bij de voordeur) gelukt is.
  trigger:
    - platform: state
      entity_id: binary_sensor.blackout_active
      to: 'on'
  condition:
    - condition: state
      entity_id: input_boolean.beepbeep_na_power_down
      state: 'on'
  action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.beepbeep_na_power_down
    - service: shell_command.beepbeep
