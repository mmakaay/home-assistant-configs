---
# This automation is based on the IKEA TrÃ¥dfri motion sensor
# This sensor reports "ON" for 1 minute, then "OFF" for 30 seconds when
# detecing motion. The state "ON" is not kept when there is still
# motion going on. While this is a bit basic, it does allow for a pretty
# simple automation.

- id: toilet_licht_A
  alias: "[TOILET LICHT] A. zet aan bij beweging"
  description: >
    Lamp aan en de timer (her)starten als er beweging wordt gedetecteerd.
  trigger:
    - entity_id: binary_sensor.toilet_beweging
      platform: state
      to: 'on'
  action:
    - service: scene.turn_on
      data_template:
        entity_id: >
          scene.toilet_automatisch_{{ states('sensor.periode_van_de_dag') }}
    # cancel/start, because of this bug:
    # https://github.com/home-assistant/home-assistant/issues/12013
    - service: timer.cancel
      data:
        entity_id: timer.toilet
    - service: timer.start
      data_template:
        entity_id: timer.toilet

- id: toilet_licht_B
  alias: "[TOILET LICHT] B. zet uit na een tijdje geen beweging"
  description: >
    Wanneer de timer afloopt, maak de lamp dan weer uit.
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.toilet
  action:
    - service: light.turn_off
      data:
        entity_id: light.toilet_plafond
