---
- id: badkamer_lamp_A
  alias: "[BADKAMER LICHT] A. zet aan bij beweging"
  description: >
    Lamp aan als er beweging wordt gedetecteerd.
  trigger:
    - entity_id: binary_sensor.badkamer_beweging
      platform: state
      to: 'on'
  action:
    - service: scene.turn_on
      data_template:
        entity_id: >
          {% if is_state("binary_sensor.sleepy_time", "on") %}
            scene.badkamer_sleepy_time
          {% else %}
            scene.badkamer_normaal
          {% endif %}
    # cancel/start, because of this bug:
    # https://github.com/home-assistant/home-assistant/issues/12013
    - service: timer.cancel
      data:
        entity_id: timer.badkamer
    - service: timer.start
      data_template:
        entity_id: timer.badkamer
        duration: >
          {% if is_state("binary_sensor.sleepy_time", "on") %}
            00:02:00
          {% else %}
            00:05:00
          {% endif %}

- id: badkamer_lamp_B
  alias: "[BADKAMER LICHT] B. zet uit na een tijdje geen beweging"
  description: >
    Wanneer de timer afloopt, maak dan de lamp weer uit.
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.badkamer
  action:
    - service: light.turn_off
      data:
        entity_id: light.badkamer_plafond
        transition: 10
